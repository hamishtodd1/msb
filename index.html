<!--
	Quite awful bug if you... hit the new suspect button twice at the start?
	Refund when suspect is deleted? You do know the cashbits' associated players...
		That's more for "unresolved" rather than "resolved in the negative"
		Want to incentivize them to sell, and in a certain order, selling is part of the game
	Could make it so ctrl+v puts a pasted image in the camera feed, useful for desktop
		Even text could go in, could use drop down window
	probably best not to scale up cash width because think about initial cash
	
	Lobbyist mode
		With lobbyist mode, you also have a lot of bets more expensive than what the person gets for them. Then, a strategy: if you know someone is trying to manipulate the price of X to be >80p at 1pm, but the true price of X is 20p, you can:
		-buy a load of bets on X at <80p
		-wait until 12:59pm when the price is 81p
		-sell a bet, price goes down to 79p
		-watch the manipulator buy so price goes back to 81p
		-sell again
		-manipulator buys again
		etc. Only problem is, you have to buy when 

		Yes, key thing is that there should be unlimited bets, so that the manipulator is forced to make the price extraordinarily high so that when everyone sells it's still above the watermark

		If you can figure out how much the manipulator gains from having the price be past the watermark, you can pump all that money out of them



		No reason why it should be secret really. Say how much cash the manipulator gets, and who they are, and what suspect they're going for.

		Easter egg: open console and set newGameButton.manipulatorMode = true before clicking it

		-how much money they get
		-how much extra money they start with
		-When the suspect appears, a 25-second timer starts. If the suspect's bets are trading at 1:1 when it's done, the manipulator gets N dollars.

		Alt
			Manipulator  will get 1 googol dollars from the market price being above 1
			So they're willing to lose .9999 = 1 googol dollars
			To bet, if there are 10 bets
	Another fun thing would be a bot mode where you see that wealth gets reallocated pretty quickly

    Send to
		Some multiplayer youtubers
		Hacker news
        Testing Groups:
			EE slack: Pontus, Nicky, Chris Makler
			Martin Todd, Diana, Lal, mum and dad
			Chigozie, Devon, Florian and Jacob
			Eleanor, Stephane, Rachel, Rory and Joel
			Ivan, Ivan, Nina, Katya
			Edindies: Norgg, Portponkey
		Serious folks (need rooms by this point, they'll want to spread it)
			London rationalish: Jason Sackey, Noah Siegel, Phil Hazelden, Maciej
			->Then ask them about, facebook rationalists: Vladyslav, Jeffrey Ladish
			York philosophy: Simon Newey, Seb, Dan, Joe Peach
			Casey, Jon Blow "colleague of Caplan's".
			Ben Cerveney, Richard Lemarchand
			Chao, Senthuran
		Odds and ends
			Eric Stansifer
			Mike Munger
			Martin Berger
			Andrew Mathers
			Other people on those panels on youtube
			that chinese harvard lady
		Publicity
			Nassim Taleb
			Jessica Hullman who visualizes uncertainty
			Philip Tetlock
			Vitalik Buterin
			Sunil Suri (wrote about futarchy, london based)
			Lex Friedman
			wsb, hacker news
			r/wsb
			r/ssc
			r/prediction markets must exist
			lesswrong
			SSC open thread
			Annie Duke
			Andy should see it
			Zvi
			Noahpinion
			Julia Galef (so you think you're good at whodunnits...)	
			rob wiblin, katja grace, Carl Shulman whoever that is
			Tom Auld and Oliver Linton if you want to give a presentation here
 -->

<html>
	<html>
	<head><meta
		charset="utf-8"><meta
		name="viewport" content="width=device-width, initial-scale=1">

		<title>Murder, She Bet [BETA]</title>

		<link href="generalStyle.css" rel="stylesheet" type="text/css">
	</head>

	<body>

	<header>
	<h1><center>Murder, She Bet</center></h1>
	</header>

	<br></br>
	
	<center><button type="button" id="newGameButton">Start a new game!</button></center>
	
	<p>
		<center>Or enter the ID of a game started by a friend:</center>
		<center><textarea id="gameIdBox" name="gameIdBox" rows="1" cols="42"></textarea></center>
		<center><button type="button" id="enterGameButton">Submit</button></center>
	</p>
	
	<br></br>

	<center><h3>A game about educated guesses<br>
and putting your money where you'd usually only put your mouth</h3></center>

	<br></br>
	
	<center>
		<h3>The controls:</h3>
	</center>
	
	<center>
		<iframe width="100%" height="51.1%" src="https://www.youtube.com/embed/wlERXS77fr0" frameborder="0"
		allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
		allowfullscreen="false"></iframe>
	</center>
			
	<br></br>

	<center><h3>The rules:</h3></center>
	<ol>
		<li>Players will watch a Murder Mystery, with multiple <em>suspects</em> that may be <em>guilty</em></li>
		<li>Suspect characters will be added to the board as they appear</li>
		<li>If a suspect is accidentally added twice, their later (rightmost) copy must be deleted</li>
		<li>Bets can be bought AND sold all the way up to when the credits roll</li>
		<li><b>When and only when</b> the credits roll, the guilt of suspects will be settled</li>
		<li>If a suspect is <em>guilty</em> their bets turn into money</li>
		<li>If not guilty, their bets are worthless</li>
		<li>The same rules apply if <em>all</em> suspects are guilty, or if <em>none</em> are</li>
	</ol>

	<br></br>

	<center><h3>For practice: The World's Shortest Murder Mystery!</h3></center>

	<center><iframe width="100%" height="51.1%" src="https://www.youtube.com/embed/z-VuX2kcaCY" frameborder="0"
		allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
		allowfullscreen="false"></iframe></center>

	<br></br>

	<center><h3>A good strategy:</h3></center>
	<ol>
		<li>Closely monitor the current percentages that each suspect's bets are at</li>
		<li>If you'd say their price is too low, eg a suspicious one is at only 8%, buy on them!</li>
		<li>If you think it's too high, and you have bets on them, sell</li>
		<li>Keep doing that! Though don't forget to look up and watch the show sometimes!</li>
		<li>(It's a mistake to think about what's currently in your hand too much!)</li>
	</ol>

	<center><h3>An advanced strategy:</h3></center>
	<ol>
		<li>Try to think up original, but credible, theories about the true answer</li>
		<li>If you hit on one very different from the market guesses, buy bets appropriately...</li>
		<li>...then tell all the other players your theory!</li>
		<li>If persuaded, they'll frantically sell and buy, and almost certainly overcompensate</li>
		<li>Bets you just bought will become overpriced so you can sell some, and pick up other bets cheaply</li>
	</ol>

	<br></br>
	
	<center><h3>Recommended shows:</h3></center>
	<center><a href='https://www.youtube.com/watch?v=ozqWHckfWuA&list=ELDjq4Joh7KgQZjOsCkR3L5w&index=8&ab_channel=WhatsNewScooby-Doo%3F'>Scooby Doo</a> (21 minutes),
	<a href='https://www.youtube.com/watch?v=gEgjkqUk87Y'>Peter Gunn</a> (24 minutes),
	<a href='https://www.youtube.com/playlist?list=PL8-N29J_E9krdoL8tticMKKTTnCmQTdgi'>Poirot,</a> (50 minutes),
	<a href='https://www.youtube.com/playlist?list=PLJfhxUKC_TVoOHuKo-HEYPpkzmtHWSA8c'>The Adventures of Sherlock Holmes</a> (50 minutes)</center>

	<br></br>
	<center><a href='https://www.reddit.com/r/MurderSheBet/'>Subreddit</a>, <a href='https://discord.gg/pBvKrNFwbh'>Discord</a></center>
	<center>This game is an adaptation by <a href='https://twitter.com/hamish_todd'>@hamish_todd</a> of a design/discovery by <a href='http://overcomingbias.com/'>Robin Hanson</a></center>
	<center>More information on the game and its philosophy can be found <a href= 'https://github.com/hamishtodd1/msb/blob/main/README.md'>here</a>.</center>

	<body>
		<script src="/socket.io/socket.io.js"></script>
		
		<script src="three.min.js"></script>

		<script src="variables.js"></script>
		<script src="miscFunctions.js"></script>

		<script src="mouse.js"></script>

		<script src="camera.js"></script>
		<script src="cashBits.js"></script>
		<script src="bets.js"></script>
		<script src="suspects.js"></script>
		<script src="board.js"></script>

		<script src="sound.js"></script>

		<script src="judgement.js"></script>

		<script>
			const module = { exports: {} }
		</script>
		<script src="shared.js"></script>

		<script src="rectangle.js"></script>

		<script src="windowResize.js"></script>

		<script src="text.js"></script>

		<script src="buttons.js"></script>

		<script src="socketStuffAndPageInitialization.js"></script>

		<script>
			async function init(socket, gameId) {
				initRectangles()

				renderer = new THREE.WebGLRenderer({ antialias: true });
				renderer.setClearColor(bgColor)

				initSuspectConfirmationWaitingSign()

				initButtons()

				let updateMouse = initMouse()
				
				await initBoard()

				//could move this up to get rid of some initial movement
				initWindowResize()

				await initJudgement(gameId)

				{
					const connectionLostBox = Rectangle({
						label: "Connection lost",
						h: 2.,
						getScaleFromLabel: true,
						haveFrame: true,
						z: 4.9
					})
					connectionLostBox.visible = false

					socket.onclose = () => {
						connectionLostBox.visible = true
						if(reloadAttempted === false) {
							location.reload()
							reloadAttempted = true
						}
					}

					let timeSinceLastPongReception = 0.
					socket.on("pongAA",()=>{
						timeSinceLastPongReception = 0.
					})
					let reloadAttempted = false
					updateFunctions.push(()=>{
						let justAboutToPass2 = timeSinceLastPongReception < 2. &&
							timeSinceLastPongReception + frameDelta >= 2.
						if( justAboutToPass2 )
							socket.emit("pingAA")

						if(timeSinceLastPongReception > 5.5) {
							socket.close()
							connectionLostBox.visible = true
						}
						if (timeSinceLastPongReception > 8. && reloadAttempted === false) {
							location.reload()
							reloadAttempted = true
						}

						timeSinceLastPongReception += frameDelta
					})
				}

				socket.emit("ready for suspect portraits")

				//it seems to go haywire when the connection is lost

				function loop() {
					let clockDelta = clock.getDelta()
					frameDelta = clockDelta < .1 ? clockDelta : .1 //clamped because debugger pauses create weirdness
					// log(1./frameDelta)

					mouse.updateFromAsync()

					// let now = Date.now()
					updateFunctions.forEach(uf => uf())
					// log((Date.now()-now)/1000.)

					++frameCount

					renderer.render(scene, camera)
					
					setTimeout(() => {
						requestAnimationFrame(loop)
					}, 1000. / 60.);
				}

				roundOffRectangleCreation()

				loop()
			}
		</script>
		
	</body>
</html>